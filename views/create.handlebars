<div class ="container-fluid">
  <div class="row">

    <!--SIDEBAR: DO NOT REMOVE-->
    <div class="col-sm-3 col-md-2 sidebar" id="sidebar">
        <h2><a href="" id="logo">OYSTER</a></h2>
        <p>Welcome <span class="member-name">{{user.email}}!</span></p>
        <ul class="nav nav-sidebar">
            <li><a href="/members"><i class="fas fa-user-tie"></i>Profile</a></li>
            <li><a href="/map"><i class="fas fa-search"></i>Search</a></li>
            <li><a href="#"><i class="fas fa-heart"></i>Favorites</a></li>
            <li><a href="/create"><i class="fas fa-heart"></i>New Adventure</a></li>
            <li><a href="/logout"><i class="fas fa-heart"></i>Logout</a></li>
        </ul>
    </div>

    {{!--COLUMN FOR EVERYTHING AFTER SIDEBAR--}}
    <div class="col-sm-6 col-sm-offset-3 col-md-10 col-md-offset-2 main">
      {{!-- MAST AND BODY NEED TO BE IN ONE ROW FOR FORMATTING ON TOP OF EACHOTHER
      NEED SEPARATE ROWS FOR MARGIN/OVERLAP --}}
      <div class="row">
        <!--HEADER: DO NOT ADJUST-->     
        <div class="row">
          <header id="masthead">
            <div class="container" id="titlehead">
               <h1>THE WORLD IS YOURS</h1>  
            </div>
            {{!-- </div> --}}
          </header>
        </div>

        <!--MODULES SHOULD POPULATE BELOW: *WIP*-->
        <div class="row" id="primary">



{{!-- -------- --}}
<div class = "col-md-6 col-md-offset-3">

    <form id="adventure-form">

        <div class="form-group">
            <label for="title">Title:</label>
            <input placeholder="Paris Je t'aime" type="text" class="form-control form-control-lg" id="title"> 
            <br>
            <label for="description">Description:</label>
            <textarea class="form-control" rows="3" id="description" ></textarea>
            <div class="form group">
                <label for="calendar">Select Your Dates</label>
                <input class="form-control" type="text" id="daterange" name="datefilter" value="" />
            </div>
            <br>
            <button type="submit" class="btn btn-primary" id="newItSub">Submit</button>
        </div>
    </form>

</div>
{{!-- -------- --}}

        </div>
        <i class="fas fa-plus-circle"></i>
      </div>                
    </div>


  </div>
</div>
























    <script type="text/javascript">
        $(function() {
            //Functions for handling the form submission
            var descriptionInput = $("#description");
            var titleInput = $("#title");
            var adForm = $("#adventure-form");

            //rendering the calendar and getting date range values
            $('#daterange').daterangepicker({
                autoUpdateInput: false,
                parentElement: adForm,
                locale: {
                cancelLabel: 'Clear'
                } 
            });

            $('#daterange').on('apply.daterangepicker', function(ev, picker) {
                $(this).val(picker.startDate.format('MM/DD/YYYY') + ' - ' + picker.endDate.format('MM/DD/YYYY'));
                startDate =   picker.startDate.format('MM/DD/YYYY');
                endDate =   picker.endDate.format('MM/DD/YYYY');
                dateRangeArr = [startDate, endDate];
                return dateRangeArr;
            });

            $('#daterange').on('cancel.daterangepicker', function(ev, picker) {
                $(this).val('');
            });

            $('#daterange').on('apply.daterangepicker', function(ev, picker) {
            });

            $(adForm).on("submit", handleFormSubmit);
                function submitAdventure(adventure){
                    $.post("api/adventures", adventure, function(){
                    //this should be a function to direct to the next page
                    console.log(adventure);
                }).then(function(results){
                     console.log(results);
                     window.location.href ="/members"
                 });
            }

            function arrayToString(arr){
                var newArr = [];
                for(var i=0; i<arr.length; i++){
                    var str = arr[i].toString();
                    newArr.push(str);
                    }
                return newArr;
            }

            function getDates(startDate, stopDate) {
                var dateArray = [];
                var currentDate = moment(startDate);
                var stopDate = moment(stopDate);
                while (currentDate <= stopDate) {
                    dateArray.push( moment(currentDate).format('MM-DD-YYYY') )
                    currentDate = moment(currentDate).add(1, 'days');
                }
                return dateArray;
            }

            //works- define the function outside the form but invoke/passarray inside the form
            function dateObjArr(arr){
                var objArr = [];
                for(var i=0; i<arr.length; i++){
                    var dateObj = {
                        date: arr[i]
                    }
                    objArr.push(dateObj);
                }
                return objArr;
            }

            function handleFormSubmit(event){
                event.preventDefault();
                if (!titleInput.val().trim() || !descriptionInput.val().trim() ) {
                    return;
                }
                var getDateArr = getDates(dateRangeArr[0], dateRangeArr[1]);
                var dateStringArray = arrayToString(getDateArr);
                var allDateObj = dateObjArr(dateStringArray);
                var rangeString = dateRangeArr.toString();
                var newAdventure = {
                    title: titleInput.val().trim(),
                    description: descriptionInput.val().trim(),
                    UserId: {{user.id}},
                    sendingarray: dateStringArray,
                    dateRange: rangeString
                }

                //may need to add in logic if we want to use this for updating a trip as well later on
                submitAdventure(newAdventure);                
            }    

        });

    </script>
